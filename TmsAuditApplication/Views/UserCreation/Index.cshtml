@model VrsAuditApplication.Models.UserModel
@{
    ViewData["Title"] = "User Creation";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div class="container mt-4 shadow-sm p-4 rounded bg-light">
    <h5 class="text-center text-primary mb-4 fw-bold">@ViewData["Title"]</h5>

    <form id="userForm" enctype="multipart/form-data">
        <!-- General Information -->
        <h6 class="fw-semibold text-secondary mb-3">General Information</h6>
        <div class="row g-3">
            <div class="col-md-2">
                <label class="form-label small">Salutation</label>
                <select name="Saluation" class="form-select form-select-sm">
                    <option>Mr.</option>
                    <option>Ms.</option>
                    <option>Mrs.</option>
                    <option>Dr.</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label small">Login Card Number</label>
                <input type="text" name="LoginCardNumber" class="form-control form-control-sm" />
            </div>
            <div class="col-md-3">
                <label class="form-label small">First Name</label>
                <input type="text" name="FirstName" class="form-control form-control-sm" />
            </div>
            <div class="col-md-3">
                <label class="form-label small">Last Name</label>
                <input type="text" name="LastName" class="form-control form-control-sm" />
            </div>
            <div class="col-md-3">
                <label class="form-label small">Date of Birth</label>
                <input type="date" name="DateOfBirth" class="form-control form-control-sm" />
            </div>
            <div class="col-md-3">
                <label class="form-label small">Email</label>
                <input type="email" name="Email" class="form-control form-control-sm" />
            </div>
            <div class="col-md-3">
                <label class="form-label small">Gender</label>
                <select name="Gender" class="form-select form-select-sm">
                    <option>Male</option>
                    <option>Female</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label small">Contact Number</label>
                <input type="text" name="ContactNumber" class="form-control form-control-sm" />
            </div>
            <div class="col-md-4">
                <label class="form-label small">Document Type</label>
                <select name="DocumentType" class="form-select form-select-sm">
                    <option>Aadhar Card</option>
                    <option>Passport</option>
                    <option>Driver's License</option>
                    <option>Voter ID</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label small">Document Number</label>
                <input type="text" name="DocumentNumber" class="form-control form-control-sm" />
            </div>
            <div class="col-md-4">
                <label class="form-label small">Job Position</label>
                <select name="JobPosition" class="form-select form-select-sm">
                    <option>TC Collector</option>
                    <option>Driver</option>
                    <option>Manager</option>
                    <option>Admin</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label small">Blacklist Status</label>
                <select name="BlacklistStatus" class="form-select form-select-sm">
                    <option>No</option>
                    <option>Yes</option>
                </select>
            </div>
            <div class="col-md-8">
                <label class="form-label small">Upload Document (PDF)</label>
                <input type="file" id="PdfDocument" name="PdfDocument" accept="application/pdf" class="form-control form-control-sm" onchange="previewPDF()" />
            </div>
        </div>

        <!-- PDF Preview -->
        <div class="mt-3" id="pdfPreviewContainer" style="display:none;">
            <label class="form-label small">Preview:</label>
            <iframe id="pdfPreview" class="border rounded" style="width:100%;height:300px;"></iframe>
        </div>

        <hr class="my-4" />

        <!-- Address Details -->
        <h6 class="fw-semibold text-secondary mb-3">Address Details</h6>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label small">City</label>
                <select id="City" name="City" class="form-select form-select-sm">
                    <option value="">--Select City--</option>
                    @foreach (var city in ViewBag.CityList)
                    {
                        <option value="@city.CityCode">@city.CityName</option>
                    }
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label small">Pin Code</label>
                <select id="PinCode" name="PinCode" class="form-select form-select-sm">
                    <option value="">--Select Pin Code--</option>
                    @foreach (var city in ViewBag.CityList)
                    {
                        <option value="@city.ZipCode">@city.ZipCode</option>
                    }
                </select>
            </div>
            <div class="col-md-12">
                <label class="form-label small">Address Line 1</label>
                <input type="text" name="AddressLine1" class="form-control form-control-sm" />
            </div>
            <div class="col-md-12">
                <label class="form-label small">Address Line 2</label>
                <input type="text" name="AddressLine2" class="form-control form-control-sm" />
            </div>
            <div class="col-md-12">
                <label class="form-label small">Address Line 3</label>
                <input type="text" name="AddressLine3" class="form-control form-control-sm" />
            </div>
            <div class="col-md-8">
                <label class="form-label small">House / Apartment No</label>
                <input type="text" name="HouseApartmentNo" class="form-control form-control-sm" />
            </div>
            <div class="col-md-4">
                <label class="form-label small">Floor</label>
                <input type="text" name="Floor" class="form-control form-control-sm" />
            </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
            <button type="reset" class="btn btn-sm btn-secondary">Clear</button>
            <button type="button" class="btn btn-sm btn-primary" onclick="saveUser()">Save</button>
        </div>
    </form>

    <div id="SuccessAndErrorMessage" class="mt-4 text-center"></div>
</div>


<script>
    $("#City").change(function () {
        $.getJSON('/UserCreation/GetZipByCity?cityCode=' + $(this).val(), function (zip) {
            $("#PinCode").val(zip);
        });
    });

    $("#PinCode").change(function () {
        $.getJSON('/UserCreation/GetCityByZip?zip=' + $(this).val(), function (city) {
            if (city) $("#City").val(city.cityCode);
        });
    });
</script>

<script>
    function previewPDF() {
        const fileInput = document.getElementById('PdfDocument');
        const previewContainer = document.getElementById('pdfPreviewContainer');
        const preview = document.getElementById('pdfPreview');

        const file = fileInput.files[0];
        if (file && file.type === 'application/pdf') {
            const fileURL = URL.createObjectURL(file);
            preview.src = fileURL;
            previewContainer.style.display = 'block';
        } else {
            previewContainer.style.display = 'none';
        }
    }

    function saveUser() {
        const form = document.getElementById('userForm');
        const formData = new FormData(form);
        fetch('@Url.Action("SaveUser", "UserCreation")', {
            method: 'POST',
            body: formData
        })
        .then(res => res.json())
        .then(result => {
            const msgDiv = document.getElementById("SuccessAndErrorMessage");
            msgDiv.innerHTML = `<div class="alert ${result.success ? 'alert-success' : 'alert-danger'}">${result.message}</div>`;
            if (result.success) form.reset();
            document.getElementById('pdfPreviewContainer').style.display = 'none';
        })
        .catch(err => {
            document.getElementById("SuccessAndErrorMessage").innerHTML =
                `<div class="alert alert-danger">Error: ${err}</div>`;
        });
    }
</script>
